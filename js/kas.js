import { db } from './firebase.js'; import { collection, addDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js'; import { qs, toast } from './ui.js'; import { isAdmin } from './roles.js';
const list=qs('#list'), saldoEl=qs('#saldo'); const money=n=>Number(n||0).toLocaleString('id-ID');
onSnapshot(collection(db,'kas'), (snap)=>{ let masuk=0,keluar=0; list.innerHTML=''; snap.docs.sort((a,b)=>(b.data().tanggal||0)-(a.data().tanggal||0)).forEach(d=>{ const t=d.data(); if(t.tipe==='keluar') keluar+=Number(t.jumlah||0); else masuk+=Number(t.jumlah||0); const row=document.createElement('div'); row.className='info-chip'; row.style.cssText='width:100%;justify-content:space-between'; row.innerHTML=`<span>${t.tipe==='keluar'?'ðŸ”»':'ðŸ”º'} Rp ${money(t.jumlah)} â€¢ ${t.ket||''}</span><small>${new Date(t.tanggal||Date.now()).toLocaleDateString('id-ID')}</small>`; list.append(row); }); saldoEl.textContent='Rp '+money(masuk-keluar); });
qs('#add').onclick=async()=>{ if(!isAdmin()) return alert('Hanya Ketua/Wakil yang dapat menambah transaksi'); const tipe=[...document.querySelectorAll('input[name="tipe"]')].find(x=>x.checked)?.value||'masuk'; const jumlah=Number(qs('#jumlah').value); const ket=qs('#ket').value.trim(); if(!jumlah) return toast('Jumlah wajib diisi'); await addDoc(collection(db,'kas'),{tipe,jumlah,ket,tanggal:Date.now()}); qs('#jumlah').value=''; qs('#ket').value=''; toast('Transaksi disimpan'); };
