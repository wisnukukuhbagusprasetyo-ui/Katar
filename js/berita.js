import { db } from './firebase.js'; import { collection, addDoc, onSnapshot, deleteDoc, doc } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js'; import { uploadToCloudinary } from './cloudinary.js'; import { qs, toast } from './ui.js'; import { isAdmin } from './roles.js';
const list=qs('#list'); onSnapshot(collection(db,'berita'), (snap)=>{ list.innerHTML=''; snap.docs.sort((a,b)=>(b.data().tanggal||0)-(a.data().tanggal||0)).forEach(d=>{ const b=d.data(); const el=document.createElement('div'); el.className='card-glass'; el.innerHTML=`<div style="display:flex;gap:12px"><img src="${b.foto||'/assets/icons/kt.svg'}" style="width:72px;height:72px;border-radius:12px;object-fit:cover"><div><div class="card-title">${b.judul||''}</div><div style="opacity:.8">${b.isi||''}</div><small class="info-chip">${new Date(b.tanggal||Date.now()).toLocaleString('id-ID')}</small>${isAdmin()? '<button class="btn-del" data-id="'+d.id+'">üóëÔ∏è Hapus</button>':''}</div></div>`; list.append(el); }); list.querySelectorAll('.btn-del').forEach(b=> b.onclick=async(e)=>{ if(confirm('Hapus berita ini?')) await deleteDoc(doc(db,'berita', e.currentTarget.dataset.id)); }); });
qs('#add').onclick=async()=>{ if(!isAdmin()) return alert('Hanya wakil/ketua yang dapat menambah berita'); const judul=qs('#judul').value.trim(), isi=qs('#isi').value.trim(), file=qs('#foto').files[0]; let foto=''; if(file) foto=await uploadToCloudinary(file,'berita'); if(!judul||!isi) return toast('Judul & Isi wajib'); await addDoc(collection(db,'berita'),{judul,isi,foto,tanggal:Date.now()}); qs('#judul').value=''; qs('#isi').value=''; qs('#foto').value=''; toast('Berita ditambahkan'); };
