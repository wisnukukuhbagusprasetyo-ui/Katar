<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KARTEJI ‚Ä¢ Karang Taruna Cilosari Barat RT01/RW08</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --biru:#0e4c92;
  --biru2:#1a6ac2;
  --emas:#f6c445;
  --bg:#0b132b;
  --card:#111928;
  --text:#e5e7eb;
  --shine:linear-gradient(120deg,#0e4c92 0%,#f6c445 40%,#0e4c92 80%);
}
*{box-sizing:border-box;scroll-behavior:smooth}
body{margin:0;font-family:'Poppins',sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden}
header{position:sticky;top:0;z-index:10;background:linear-gradient(90deg,var(--biru),var(--biru2));padding:.8rem 1rem;display:flex;align-items:center;justify-content:space-between;box-shadow:0 4px 20px rgba(0,0,0,.3)}
.brand{display:flex;gap:.6rem;align-items:center}
.brand img{width:36px;height:36px;filter:drop-shadow(0 0 6px rgba(246,196,69,.6))}
.brand span{font-weight:700;font-size:1.1rem;background:var(--shine);-webkit-background-clip:text;color:transparent;animation:shine 4s linear infinite;background-size:200%}
@keyframes shine{0%{background-position:0%}100%{background-position:200%}}
.hb{display:flex;flex-direction:column;gap:4px;cursor:pointer}
.hb i{width:22px;height:3px;background:#fff;border-radius:2px;transition:.3s}
nav{display:none;flex-direction:column;background:#0e4c92}
nav a{color:#fff;padding:.9rem 1rem;text-decoration:none;border-top:1px solid rgba(255,255,255,.1);font-weight:600}
nav.show{display:flex}
@media(min-width:800px){
  .hb{display:none}
  nav{display:flex !important;flex-direction:row;background:transparent}
  nav a{border:none;padding:0 1rem}
  nav a:hover{color:var(--emas)}
}
.container{max-width:1100px;margin:auto;padding:1rem}
.section-title{font-size:1.3rem;color:#fff;border-left:5px solid var(--emas);padding-left:.6rem;margin:1rem 0}
.grid{display:grid;gap:1rem}
.grid-2{grid-template-columns:repeat(auto-fill,minmax(280px,1fr))}
.grid-3{grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
.card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.25);overflow:hidden;transform:translateZ(0);transition:.3s}
.card:hover{transform:translateY(-5px) scale(1.01);box-shadow:0 8px 24px rgba(246,196,69,.2)}
.card .pad{padding:1rem}
.btn{display:inline-block;background:var(--emas);color:#0e4c92;border:none;border-radius:8px;padding:.5rem .8rem;font-weight:700;text-decoration:none;transition:.3s}
.btn:hover{background:#ffda5e}
.note{opacity:.75}
.thumb{width:100%;height:170px;object-fit:cover;display:block}
.badge{display:inline-block;background:#1f2a44;color:#fff;border:1px solid rgba(255,255,255,.1);border-radius:999px;padding:.2rem .6rem;font-size:.8rem}
.hero{background:radial-gradient(circle at 20% 20%,#1a6ac2 0%,#0e4c92 60%,#091b33 100%);padding:3rem 1rem;border-bottom:3px solid var(--emas);position:relative;overflow:hidden}
.hero::after{content:"";position:absolute;inset:0;background:radial-gradient(circle at 70% 30%,rgba(246,196,69,.1),transparent 60%);z-index:0}
.hero h1{margin:0;font-size:1.8rem;color:#fff;text-shadow:0 0 8px rgba(246,196,69,.3)}
.hero p{opacity:.9;max-width:600px}
.hero .btn{margin-top:1rem}
footer{padding:1rem;text-align:center;opacity:.7;background:#0a152c;border-top:1px solid rgba(255,255,255,.1)}
footer span{color:var(--emas)}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);align-items:center;justify-content:center;z-index:20;backdrop-filter:blur(4px)}
.box{background:#101826;border:1px solid rgba(255,255,255,.15);border-radius:12px;padding:1.2rem;width:min(90%,420px);box-shadow:0 0 20px rgba(246,196,69,.2)}
.box h3{margin:.2rem 0 1rem;color:var(--emas)}
.box input{width:100%;padding:.6rem;border-radius:8px;border:1px solid #2b3a55;background:#0d1425;color:#fff;margin-bottom:.6rem}
.box .row{display:flex;gap:.5rem;flex-wrap:wrap}
.glow{position:fixed;inset:0;pointer-events:none;background:radial-gradient(circle at var(--x,50%) var(--y,50%),rgba(246,196,69,.1),transparent 60%);z-index:1;mix-blend-mode:screen;transition:background 0.2s}
</style>
</head>
<body>

<header>
  <div class="brand">
    <img src="logo.png" alt="logo">
    <span>KARTEJI</span>
  </div>
  <div class="hb" id="hb"><i></i><i></i><i></i></div>
  <nav id="nav">
    <a href="#pengumuman">Pengumuman</a>
    <a href="#berita">Berita</a>
    <a href="#umkm">UMKM</a>
    <a href="#kas">Kas</a>
    <a id="toDashboard" href="profil.html" style="display:none">Profil</a>
    <a id="openLogin" href="#">Masuk</a>
  </nav>
</header>

<div class="hero">
  <div class="container" style="position:relative;z-index:2">
    <h1>Portal Karang Taruna Cilosari Barat</h1>
    <p>RT01/RW08 ‚Ä¢ Kelurahan Kemijen ‚Ä¢ Kecamatan Semarang Timur<br>Tempat bersatu, berinovasi, dan berdaya bersama.</p>
    <a href="#pengumuman" class="btn">Jelajahi Portal</a>
  </div>
</div>

<div class="container">
  <section id="pengumuman">
    <h2 class="section-title">üì¢ Pengumuman</h2>
    <div id="pengList" class="grid grid-2"></div>
  </section>

  <section id="berita">
    <h2 class="section-title">üì∞ Berita</h2>
    <div id="beritaList" class="grid grid-3"></div>
  </section>

  <section id="umkm">
    <h2 class="section-title">üè™ Produk UMKM</h2>
    <div id="umkmList" class="grid grid-3"></div>
  </section>

  <section id="kas">
    <h2 class="section-title">üí∞ Ringkasan Kas</h2>
    <div class="card"><div class="pad">
      <div class="badge">Total Kas</div>
      <h2 id="kasTotal" style="margin:.4rem 0 0;font-weight:700;color:var(--emas)">Rp 0</h2>
      <p class="note">Detail transaksi tersedia di dashboard anggota.</p>
    </div></div>
  </section>
</div>

<footer>
  <p>¬© 2025 <span>KARTEJI</span> ‚Äî Karang Taruna Cilosari Barat RT01/RW08 ‚Ä¢ Semarang</p>
</footer>

<div class="glow" id="glow"></div>

<!-- Modal Login/Daftar -->
<div class="modal" id="authModal">
  <div class="box">
    <h3>Masuk / Daftar</h3>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="pass" placeholder="Kata sandi">
    <div class="row">
      <button class="btn" id="btnLogin">Masuk</button>
      <button class="btn" id="btnReg">Daftar</button>
    </div>
    <div class="row" style="margin-top:.4rem">
      <button class="btn" id="btnReset" style="background:#22314f;color:#fff">Lupa Password?</button>
      <button class="btn" id="btnClose" style="background:#22314f;color:#fff;margin-left:auto">Tutup</button>
    </div>
  </div>
</div>

<!-- ==== SCRIPT ==== -->
<script type="module" src="js/firebase.js"></script>
<script type="module" src="js/auth.js"></script>

<script>
// glow follow cursor
const glow=document.getElementById("glow");
document.addEventListener("mousemove",e=>{
 glow.style.setProperty("--x",e.clientX+"px");
 glow.style.setProperty("--y",e.clientY+"px");
});
// nav toggle
const hb=document.getElementById("hb");
const nav=document.getElementById("nav");
hb.onclick=()=>nav.classList.toggle("show");

// modal login
const modal=document.getElementById("authModal");
document.getElementById("openLogin").onclick=e=>{e.preventDefault();modal.style.display="flex";}
document.getElementById("btnClose").onclick=()=>modal.style.display="none";
const email=document.getElementById("email");
const pass=document.getElementById("pass");

document.getElementById("btnLogin").onclick=async()=>{
  try{
    await window.AuthAPI.login(email.value.trim(),pass.value);
    modal.style.display="none";
    location.href="profil.html";
  }catch(e){alert(e.message);}
};
document.getElementById("btnReg").onclick=async()=>{
  try{
    await window.AuthAPI.register(email.value.trim(),pass.value);
    modal.style.display="none";
    location.href="profil.html";
  }catch(e){alert(e.message);}
};
document.getElementById("btnReset").onclick=async()=>{
  if(!email.value.trim())return alert("Isi email dulu");
  try{
    await window.AuthAPI.reset(email.value.trim());
    alert("Link reset dikirim ke email");
  }catch(e){alert(e.message);}
};

// tampil tombol dashboard kalau login
window.AuthAPI?.onAuth(u=>{
  document.getElementById("toDashboard").style.display=u?"inline-block":"none";
});

// Load data publik
async function whenFbReady(fn){
  if(window.AuthAPI?.db){fn();return;}
  const id=setInterval(()=>{if(window.AuthAPI?.db){clearInterval(id);fn();}},100);
}

whenFbReady(async()=>{
  const { db } = window.AuthAPI;
  const { collection, getDocs, orderBy, query } = await import("https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js");

  async function loadCol(col,wrap,limit=4,thumbKey){
    const q = query(collection(db,col),orderBy("createdAt","desc"));
    const s = await getDocs(q);
    if(s.empty){wrap.innerHTML="<p class='note'>Belum ada data.</p>";return;}
    let c=0;
    s.forEach(d=>{
      if(c>=limit)return; c++;
      const v=d.data();
      let img="";
      if(Array.isArray(v[thumbKey])&&v[thumbKey][0]) img=`<img class='thumb' src='${v[thumbKey][0]}'>`;
      wrap.innerHTML += `<div class='card'>${img}<div class='pad'><h3>${v.judul||v.produk||'(Tanpa judul)'}</h3>
      <p>${(v.isi||v.deskripsi||'').slice(0,150)}...</p></div></div>`;
    });
  }

  loadCol("pengumuman",document.getElementById("pengList"),4);
  loadCol("berita",document.getElementById("beritaList"),6,"foto");
  loadCol("umkm",document.getElementById("umkmList"),6,"foto");

  const ks=await getDocs(collection(db,"kas"));let total=0;
  ks.forEach(d=>{const k=d.data();total+=(k.tipe==="masuk"?1:-1)*(k.jumlah||0)});
  document.getElementById("kasTotal").textContent="Rp "+total.toLocaleString();
});
</script>
</body>
</html>