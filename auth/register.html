<!doctype html><html lang="id"><head>
<script>
// ======== AUTO CLEAR CACHE / SERVICE WORKER (v7.6.1) ========
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.getRegistrations().then(regs => regs.forEach(r => r.unregister()));
  caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
}
</script>
<meta name="version" content="7.6.1">
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Daftar • Karang Taruna Cilosari Barat</title><link rel="stylesheet" href="../css/style.css"><link rel="manifest" href="../manifest.webmanifest"></head><body>
<header class="header-glass"><div class="header-title"><img class="logo-glow" src="../assets/icons/kt.svg" width="36" height="36"><div>Daftar Akun Baru</div></div><a class="info-chip" href="./login.html">Sudah punya akun? Masuk</a></header>
<main class="container" style="max-width:520px"><div class="card-glass">
<div class="input-wrap"><label>Nama</label><input id="nama" type="text"></div>
<div class="input-wrap" style="margin-top:10px"><label>Email</label><input id="email" type="email"></div>
<div class="input-wrap" style="margin-top:10px"><label>Password</label><input id="password" type="password"></div>
<div style="margin-top:14px"><button id="btnReg" class="btn-glass">Daftar</button></div>
</div><p class="footer-note">Default role: anggota → bisa dinaikkan oleh Ketua (super_admin)</p></main>
<script type="module">
import { auth, db } from '../js/firebase.js'; import { createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js'; import { doc, setDoc, getDocs, collection } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js';
document.getElementById('btnReg').onclick=async()=>{const n=document.getElementById('nama').value.trim(), e=document.getElementById('email').value.trim(), p=document.getElementById('password').value; if(!n||!e||!p) return alert('Lengkapi semua data'); const col=await getDocs(collection(db,'users')); const isFirst = col.empty; const u=await createUserWithEmailAndPassword(auth,e,p); await setDoc(doc(db,'users',u.user.uid),{nama:n,email:e,role:isFirst?'super_admin':'anggota',createdAt:Date.now()}); alert(isFirst?'Registrasi berhasil! Akun ini otomatis menjadi Ketua (super_admin)':'Registrasi berhasil!'); location.href='/index.html';};
if('serviceWorker'in navigator) navigator.serviceWorker.register('/service-worker.js');
</script></body></html>