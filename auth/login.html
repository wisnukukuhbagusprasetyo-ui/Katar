<!doctype html><html lang="id"><head>
<script>
// ======== AUTO CLEAR CACHE / SERVICE WORKER (v7.6.1) ========
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.getRegistrations().then(regs => regs.forEach(r => r.unregister()));
  caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
}
</script>
<meta name="version" content="7.6.1">
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Masuk • Karang Taruna Cilosari Barat</title><link rel="stylesheet" href="../css/style.css"><link rel="manifest" href="../manifest.webmanifest"></head><body>
<header class="header-glass"><div class="header-title"><img class="logo-glow" src="../assets/icons/kt.svg" width="36" height="36"><div>Masuk Portal Karang Taruna</div></div><a class="info-chip" href="./register.html">Daftar</a></header>
<main class="container" style="max-width:520px"><div class="card-glass">
<div class="input-wrap"><label>Email</label><input id="email" type="email"></div>
<div class="input-wrap" style="margin-top:10px"><label>Password</label><input id="password" type="password"></div>
<div style="display:flex;gap:10px;margin-top:14px"><button id="btnLogin" class="btn-glass">Masuk</button><a class="info-chip" href="./forgot.html">Lupa password?</a></div>
</div><p class="footer-note">v7.4 • Firebase Auth</p></main>
<script type="module">
import { auth, db } from '../js/firebase.js'; import { signInWithEmailAndPassword, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js'; import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js';
document.getElementById('btnLogin').onclick=async()=>{const e=document.getElementById('email').value.trim(), p=document.getElementById('password').value.trim(); if(!e||!p) return alert('Lengkapi email & password'); try{ const cred=await signInWithEmailAndPassword(auth,e,p); const ref=doc(db,'users',cred.user.uid); const s=await getDoc(ref); const role=s.exists()? (s.data().role||'anggota'):'anggota'; alert(role==='super_admin'?'Selamat datang, Ketua Karang Taruna!':'Login berhasil!'); location.href='/index.html'; }catch(err){ alert(err.message);} };
onAuthStateChanged(auth,u=>{ if(u) location.href='/index.html'; }); if('serviceWorker'in navigator) navigator.serviceWorker.register('/service-worker.js');
</script></body></html>